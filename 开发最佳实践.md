# 开发最佳实践 - 避免网页打不开问题

## 🎯 问题根源

修改代码时网页打不开的常见原因：
1. **编译错误**：TypeScript 类型错误导致编译失败
2. **缓存问题**：`.next` 目录缓存损坏
3. **进程残留**：旧的 Node 进程占用端口
4. **自动重编译失败**：Next.js 的快速刷新功能失效

## ✅ 推荐的开发流程

### 1. **修改代码前**

运行 `修改代码前检查.bat`，确保：
- 服务器正在运行
- TypeScript 类型检查通过
- 工作目录状态正常

### 2. **修改代码时**

**最佳实践：**
- ✅ 保存文件后，观察终端是否有编译错误
- ✅ 等待自动重新编译完成（通常 5-10 秒）
- ✅ 如果看到错误，立即修复，不要继续修改

**避免的操作：**
- ❌ 同时修改多个可能导致类型错误的文件
- ❌ 在有编译错误时继续修改代码
- ❌ 手动删除 `.next` 目录（除非真的需要）

### 3. **修改代码后**

**如果网页无法打开：**

1. **立即检查终端**
   - 查看是否有编译错误（红色错误信息）
   - 查看是否有端口占用错误

2. **快速修复步骤**
   ```
   1. 运行：智能重启服务器.bat
   2. 等待 15-20 秒
   3. 刷新浏览器 (Ctrl + F5)
   ```

3. **如果仍然不行**
   ```
   1. 检查浏览器控制台 (F12) 的错误信息
   2. 运行：npx tsc --noEmit
   3. 检查是否有类型错误需要修复
   ```

## 🛠️ 工具脚本说明

### 1. `智能重启服务器.bat`
**用途**：智能重启开发服务器，包含完整的清理和检查流程

**使用时机**：
- 修改代码后网页打不开
- 遇到缓存问题
- 端口占用问题

**特点**：
- 自动清理缓存
- 编译检查
- 状态提示

### 2. `开发服务器监控.ps1`
**用途**：自动监控服务器状态，出现问题自动重启

**使用时机**：
- 长时间开发时后台运行
- 担心服务器意外停止

**运行方式**：
```powershell
powershell -ExecutionPolicy Bypass -File 开发服务器监控.ps1
```

### 3. `修改代码前检查.bat`
**用途**：在修改代码前检查环境状态

**使用时机**：
- 准备进行重要修改前
- 怀疑环境有问题时

## 📋 常见问题快速解决

### 问题 1: "Cannot find module './xxx.js'"
**原因**：构建缓存损坏

**解决**：
```powershell
Remove-Item -Recurse -Force .next
npm run build
npm run dev
```

### 问题 2: "Port 3000 is already in use"
**原因**：端口被占用

**解决**：
```powershell
Get-Process -Name node | Stop-Process -Force
npm run dev
```

### 问题 3: TypeScript 类型错误
**原因**：类型定义不匹配

**解决**：
```powershell
npx tsc --noEmit  # 查看具体错误
# 修复错误后
npm run dev
```

### 问题 4: 网页空白/无法加载
**原因**：编译失败但服务器还在运行

**解决**：
1. 检查终端是否有错误
2. 运行 `智能重启服务器.bat`
3. 等待编译完成后再刷新

## 🔄 推荐的开发工作流

```
1. 启动开发服务器
   → npm run dev 或运行 重启开发服务器.bat

2. 修改代码
   → 保存文件
   → 观察终端输出
   → 等待自动重编译

3. 测试修改
   → 刷新浏览器 (F5)
   → 如果出现问题，强制刷新 (Ctrl + F5)

4. 如果网页打不开
   → 立即运行 智能重启服务器.bat
   → 不要继续修改代码直到问题解决
```

## 🎯 预防措施

### 开发时：
1. **保持终端窗口可见**：随时查看编译状态
2. **小步提交**：频繁保存和测试，不要一次改太多
3. **先检查再修改**：运行 `修改代码前检查.bat`
4. **使用监控脚本**：长时间开发时运行监控脚本

### 部署前：
1. **本地构建测试**：`npm run build`
2. **TypeScript 检查**：`npx tsc --noEmit`
3. **功能测试**：确保所有功能正常

## 📝 检查清单

在推送代码到 Git 前：
- [ ] `npx tsc --noEmit` 通过
- [ ] `npm run build` 成功
- [ ] 本地测试所有功能正常
- [ ] 浏览器控制台无错误

---

**记住**：修改代码前先检查，遇到问题立即重启，保持终端可见！

